name: Bot Subrek All-In-One

on: 
  workflow_dispatch:

jobs:
  mission-start:
    runs-on: ubuntu-latest
    steps:
      - name: Install Selenium
        run: pip install selenium webdriver-manager

      - name: Build & Run Bot
        run: |
          cat <<EOF > bot.py
          from selenium import webdriver
          from selenium.webdriver.chrome.service import Service
          from webdriver_manager.chrome import ChromeDriverManager
          from selenium.webdriver.common.by import By
          from selenium.webdriver.common.keys import Keys
          import time
          import random
          import string

          def random_str(length=6):
              return ''.join(random.choices(string.ascii_lowercase, k=length))

          options = webdriver.ChromeOptions()
          options.add_argument('--headless')
          options.add_argument('--no-sandbox')
          options.add_argument('--disable-dev-shm-usage')
          options.add_argument('user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36')

          driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)

          def execute():
              try:
                  # 1. PROSES BIKIN AKUN / LOGIN (Logika Sakti Kamu)
                  print("Membuka Google Signup...")
                  driver.get("https://accounts.google.com/signup")
                  time.sleep(3)
                  
                  # Isi Nama (Contoh)
                  driver.find_element(By.NAME, "firstName").send_keys("User")
                  driver.find_element(By.NAME, "lastName").send_keys(random_str())
                  driver.find_element(By.XPATH, "//span[contains(text(), 'Next') or contains(text(), 'Berikutnya')]").click()
                  time.sleep(3)
                  print("Proses registrasi berjalan...")

                  # 2. GAS KE LINK YOUTUBE
                  print("Meluncur ke link YouTube target...")
                  driver.get("https://youtube.com/@asipver123?si=PUEr2IJ_hlz7Tznz")
                  time.sleep(5)

                  # 3. KLIK SUBREK (Pencarian Ganda)
                  try:
                      # Cari tombol pake aria-label (lebih stabil di server luar)
                      sub_btn = driver.find_element(By.CSS_SELECTOR, "button[aria-label*='Subscribe'], button[aria-label*='Subskripsi']")
                      sub_btn.click()
                      print("MANTAP! Tombol Subrek diklik!")
                  except:
                      # Cadangan kalau CSS Selector gagal
                      sub_btn = driver.find_element(By.XPATH, "//button//span[contains(text(), 'Sub')]")
                      sub_btn.click()
                      print("Subrek lewat jalur cadangan sukses!")

              except Exception as e:
                  print(f"Waduh ada kendala: {e}")
              finally:
                  print("Misi selesai, runner otomatis mati.")
                  driver.quit()

          if __name__ == "__main__":
              execute()
          EOF
          
          python bot.py
